<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Aptitude Test</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="panel centered">
    <h1>Medical Aptitude Test (10 MCQs)</h1>
    <p class="muted">Answer all questions and submit — result will be saved.</p>

    <form id="quizForm" class="quiz"></form>

    <div class="row">
      <button id="submitTest" class="primary">Submit Test</button>
      <button id="back" class="outline">Back</button>
    </div>
  </div>

  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
  <script src="firebase.js"></script>

  <script>
    auth.onAuthStateChanged(u => { if(!u) window.location.href = "index.html"; });

    // Simple 10 MCQs (example). You can replace questions later.
    const questions = [
      {q:"Q1. The human heart has how many chambers?", a:["2","3","4","5"], correct:2},
    {q:"Q2. Which organ is responsible for filtering blood?", a:["Liver","Kidney","Lungs","Stomach"], correct:1},
    {q:"Q3. DNA stands for:", a:["Deoxy Nuclei Acid","Deoxyribonucleic Acid","Deoxy Neuro Acid","Dual Nucleotide Acid"], correct:1},
    {q:"Q4. Which blood group is called the universal donor?", a:["A+","O−","B−","AB+"], correct:1},
    {q:"Q5. What is the normal human body temperature?", a:["95°F","98.6°F","105°F","92°F"], correct:1},
    {q:"Q6. The smallest unit of life is:", a:["Cell","Tissue","Organ","Atom"], correct:0},
    {q:"Q7. Which vitamin is produced by the skin in sunlight?", a:["Vitamin C","Vitamin D","Vitamin B","Vitamin A"], correct:1},
    {q:"Q8. The study of fungi is called:", a:["Zoology","Botany","Mycology","Microbiology"], correct:2},
    {q:"Q9. The instrument used to check blood pressure is:", a:["Hygrometer","Sphygmomanometer","Barometer","Hydrometer"], correct:1},
    {q:"Q10. Malaria is caused by:", a:["Virus","Bacteria","Protozoa","Fungus"], correct:2},

    ];

    const form = document.getElementById("quizForm");
    questions.forEach((item, idx) => {
      const block = document.createElement("div");
      block.className = "qblock";
      block.innerHTML = `<p class="qnum">${idx+1}. ${item.q}</p>`;
      item.a.forEach((opt,i) => {
        const id = `q${idx}_opt${i}`;
        block.innerHTML += `<label><input type="radio" name="q${idx}" value="${i}" id="${id}"> ${opt}</label>`;
      });
      form.appendChild(block);
    });

    document.getElementById("submitTest").addEventListener("click", async () => {
      // compute score
      let score = 0;
      const answers = [];
      for(let i=0;i<questions.length;i++){
        const val = form[`q${i}`].value;
        answers.push(val === "" ? null : Number(val));
        if(Number(val) === questions[i].correct) score++;
      }

      const career = localStorage.getItem("careerChoice") || "not-set";
      const location = localStorage.getItem("studyLocation") || "not-set";

      const user = auth.currentUser;
      if(!user) return alert("Please login first.");

      // save score to Firestore
      try {
        await db.collection("aptitudeScores").add({
          studentId: user.uid,
          email: user.email,
          career,
          location,
          score,
          answers,
          createdAt: firebase.firestore.FieldValue.serverTimestamp()
        });
        alert(`Test submitted — your score: ${score}/${questions.length}`);
        // redirect to result page or student dashboard
        window.location.href = "student_result.html";
      } catch (err) {
        alert("Error saving result: " + err.message);
      }
    });

    document.getElementById("back").addEventListener("click", () => window.location.href = "location.html");
  </script>
</body>
</html>
