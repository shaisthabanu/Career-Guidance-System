<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Aptitude Test</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="panel centered">
    <h1>Aptitude Test (10 MCQs)</h1>
    <p class="muted">Answer all questions and submit — result will be saved.</p>

    <form id="quizForm" class="quiz"></form>

    <div class="row">
      <button id="submitTest" class="primary">Submit Test</button>
      <button id="back" class="outline">Back</button>
    </div>
  </div>

  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
  <script src="firebase.js"></script>

  <script>
    auth.onAuthStateChanged(u => { if(!u) window.location.href = "index.html"; });

    // Simple 10 MCQs (example). You can replace questions later.
    const questions = [
      {q:"What is 2+2?", a:["3","4","5","6"], correct:1},
      {q:"Which is a programming language?", a:["HTML","CSS","JavaScript","Photoshop"], correct:2},
      {q:"H2O is:", a:["Oxygen","Hydrogen","Water","Salt"], correct:2},
      {q:"CPU stands for:", a:["Central Processing Unit","Computer Power Unit","Central Program Unit","None"], correct:0},
      {q:"Which is not a database?", a:["MySQL","MongoDB","Firebase","Photoshop"], correct:3},
      {q:"Binary uses digits:", a:["0 & 1","0-9","A-Z","None"], correct:0},
      {q:"Earth is the ___ planet from sun", a:["1st","2nd","3rd","4th"], correct:2},
      {q:"HTML is used for:", a:["Styling","Content structure","Programming","Database"], correct:1},
      {q:"CSS stands for:", a:["Cascading Style Sheets","Computer Style Sheets","Creative Style System","None"], correct:0},
      {q:"JS is primarily used for:", a:["Backend only","Frontend interactivity","Database","Design"], correct:1}
    ];

    const form = document.getElementById("quizForm");
    questions.forEach((item, idx) => {
      const block = document.createElement("div");
      block.className = "qblock";
      block.innerHTML = `<p class="qnum">${idx+1}. ${item.q}</p>`;
      item.a.forEach((opt,i) => {
        const id = `q${idx}_opt${i}`;
        block.innerHTML += `<label><input type="radio" name="q${idx}" value="${i}" id="${id}"> ${opt}</label>`;
      });
      form.appendChild(block);
    });

    document.getElementById("submitTest").addEventListener("click", async () => {
      // compute score
      let score = 0;
      const answers = [];
      for(let i=0;i<questions.length;i++){
        const val = form[`q${i}`].value;
        answers.push(val === "" ? null : Number(val));
        if(Number(val) === questions[i].correct) score++;
      }

      const career = localStorage.getItem("careerChoice") || "not-set";
      const location = localStorage.getItem("studyLocation") || "not-set";

      const user = auth.currentUser;
      if(!user) return alert("Please login first.");

      // save score to Firestore
      try {
        await db.collection("aptitudeScores").add({
          studentId: user.uid,
          email: user.email,
          career,
          location,
          score,
          answers,
          createdAt: firebase.firestore.FieldValue.serverTimestamp()
        });
        alert(`Test submitted — your score: ${score}/${questions.length}`);
        // redirect to result page or student dashboard
        window.location.href = "student_result.html";
      } catch (err) {
        alert("Error saving result: " + err.message);
      }
    });

    document.getElementById("back").addEventListener("click", () => window.location.href = "location.html");
  </script>
</body>
</html>
